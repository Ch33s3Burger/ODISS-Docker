# Scripts

## Setup script <a name="setup"></a>

The setup is the main script which has to be executed before starting the docker conatainers and before executing the other scripts.
It reads the configurations from the `./env/___.properties` (default: dev.properties) and enters them in several different places.
On the one hand the script creates the `./config` folder based on the `./config_templates` folder. But it replaces all variables with the definitions from the configuration file.
On the other hand it also adjusts the scripts that are listed below.

Run the `setup.sh` script from the project source folder. The default vonfiguration is **dev**.

```
sh setup.sh dev
```

To use another config replace the first input parameter with the file name.
(ex.: The config that should be used is called `example.properties`. The execute the script with `sh setup.sh example`)

Every other script is generated by the [setup](#setup) script. These scripts are located in the `script/` folder.
This is necessary because of the authentication with the respective container and the setting of the certificate file names

## Self signed Certificate creation<a name="CertCreation"></a>


### Kafka Certificate generator

This script runs you through the process of creating the Kafka certificates. They are automatically saved in the `./config/kafka/certs/` folder.
The most important definition is the Fully Qualified Domain Name (FQDN, this should be the same as the `ODISS_SERVER_NAME` definition)

Run the `kafka_cert_generator.sh` script from within the `script/` folder.

```
bash kafka_cert_generator.sh
```

### Nginx Certificate generator

This script is similar to the Kafka Certificate creation script. It runs you through the process of creating the Nginx certificates. They are automatically saved in the `./config/nginx/certs/` folder.
The most important definition is the Fully Qualified Domain Name (FQDN, this should be the same as the `ODISS_SERVER_NAME` definition)

Run the `nginx_cert_generator.sh` script from within the `script/` folder.

```
bash nginx_cert_generator.sh
```

## Auto connection between containers

### Auto Kafka Ingestion

This script connects to the Supervisor of the Apache Druid Coordinator. The script sends the ingestion definitions in json.
The Supervisor then compiles the ingestion definition. If the definition is qualified it returns the ID of the new ingestion method.
In this case the ingestion is a Kafka ingestion. The json definition is stored in the [./config_templates/druid/druid_supervisor_config](../config_templates/druid/druid_supervisor_config).
After running the setup script the json ingestion configs are located in the `./config/druid/druid_supervisor_config` with the right credentials to Kafka container.

Run the `auto_kafka_ingestion.sh` script from within the `script/` folder.

```
sh auto_kafka_ingestion.sh
```

### Auto Metabase to Trino connection

This script connects Metabase to the Druid catalog in Trino. First it requests a session ID. Without the id all other requests would be blocked automatically.
Next, the JSON definition for the connection to Trino is sent. 

Run the `auto_metabase_trino_connection.sh` script from within the `script/` folder.

```
sh auto_metabase_trino_connection.sh
```