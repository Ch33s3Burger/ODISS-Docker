#
# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at
#
#   http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.
#

# Java tuning
DRUID.XMX=1g
DRUID.XMS=1g
DRUID.MAXNEWSIZE=250m
DRUID.NEWSIZE=250m
DRUID.MAXDIRECTMEMORYSIZE=6172m

druid.emitter.logging.logLevel=${ODISS_DRUID_LOG_LEVEL}

druid.extensions.loadList=["druid-hdfs-storage", "druid-kafka-indexing-service", "druid-datasketches", "druid-basic-security", "postgresql-metadata-storage"]

druid.metadata.storage.host=
druid.metadata.storage.type=postgresql
druid.metadata.storage.connector.connectURI=jdbc:postgresql://postgres:5432/druid
druid.metadata.storage.connector.user=${ODISS_POSTGRES_USER}
druid.metadata.storage.connector.password=${ODISS_POSTGRES_PASSWORD}

druid.coordinator.balancer.strategy=cachingCost

druid.indexer.runner.javaOptsArray=["-server", "-Xmx1g", "-Xms1g", "-XX:MaxDirectMemorySize=3g", "-Duser.timezone=UTC", "-Dfile.encoding=UTF-8", "-Djava.util.logging.manager=org.apache.logging.log4j.jul.LogManager"]
druid.indexer.fork.property.druid.processing.buffer.sizeBytes=256MiB

druid.storage.type=local
druid.storage.storageDirectory=/opt/shared/segments
druid.indexer.logs.type=file
druid.indexer.logs.directory=/opt/shared/indexing-logs

druid.processing.numThreads=2
druid.processing.numMergeBuffers=2

DRUID.LOG4J=<?xml version="1.0" encoding="UTF-8" ?><Configuration status="${ODISS_DRUID_LOG_LEVEL}"><Appenders><Console name="Console" target="SYSTEM_OUT"><PatternLayout pattern="%d{ISO8601} %p [%t] %c - %m%n"/></Console></Appenders><Loggers><Root level="${ODISS_DRUID_LOG_LEVEL}"><AppenderRef ref="Console"/></Root><Logger name="org.apache.druid.jetty.RequestLog" additivity="false" level="${ODISS_DRUID_LOG_LEVEL}"><AppenderRef ref="Console"/></Logger></Loggers></Configuration>
DRUID.LOG.LEVEL=${ODISS_DRUID_LOG_LEVEL}

druid.router.managementProxy.enabled=true

# Zookeeper
druid.zk.service.user=${ODISS_DRUID_ZOOKEEPER_SERVER_USERNAME}
druid.zk.service.pwd=${ODISS_DRUID_ZOOKEEPER_SERVER_PASSWORD}
druid.zk.service.host=zookeeper

druid.worker.capacity=2

druid.router.sql.enable=true

# Druid basic security
druid.auth.authenticatorChain=["MyBasicMetadataAuthenticator"]
druid.auth.authenticator.MyBasicMetadataAuthenticator.type=basic
 
# Default password for 'admin' user, should be changed for production.
druid.auth.authenticator.MyBasicMetadataAuthenticator.initialAdminPassword=${ODISS_DRUID_ADMIN_PASSWORD}
 
# Default password for internal 'druid_system' user, should be changed for production.
druid.auth.authenticator.MyBasicMetadataAuthenticator.initialInternalClientPassword=${ODISS_DRUID_DRUID_SYSTEM_PASSWORD}
 
# Uses the metadata store for storing users, you can use authentication API to create new users and grant permissions
druid.auth.authenticator.MyBasicMetadataAuthenticator.credentialsValidator.type=metadata
 
# If true and the request credential doesn't exists in this credentials store, the request will proceed to next Authenticator in the chain.
druid.auth.authenticator.MyBasicMetadataAuthenticator.skipOnFailure=false
 
druid.auth.authenticator.MyBasicMetadataAuthenticator.authorizerName=MyBasicMetadataAuthorizer
 
# Escalator
druid.escalator.type=basic
druid.escalator.internalClientUsername=${ODISS_DRUID_INTERNAL_CLIENT_USERNAME}
druid.escalator.internalClientPassword=${ODISS_DRUID_INTERNAL_CLIENT_PASSWORD}
druid.escalator.authorizerName=MyBasicMetadataAuthorizer
 
druid.auth.authorizers=["MyBasicMetadataAuthorizer"]
 
druid.auth.authorizer.MyBasicMetadataAuthorizer.type=basic
 
druid.javascript.enabled=true
